rm(eigenvalues.df)
# Chunk 7: ampliseq_1kgp
# Check the expected order of samples
eigenvectors.df[c(2504,2505),c("sample","PC1")]
# Prepare phenotypes for ampliseq-kgen data
phenotypes_ampliseq.df <- phenotypes.df[1:515,c("long_ids","cc")]
table(phenotypes_ampliseq.df$cc)
"UBC" -> phenotypes_ampliseq.df$cc[phenotypes_ampliseq.df$cc==0]
"CBC" -> phenotypes_ampliseq.df$cc[phenotypes_ampliseq.df$cc==1]
table(phenotypes_ampliseq.df$cc)
c("sample","group") -> colnames(phenotypes_ampliseq.df)
phenotypes_kgen.df <- kg_phenotypes.df[,c("sample","super_pop")]
c("sample","group") -> colnames(phenotypes_kgen.df)
phenotypes_ampliseq_kgen.df <- rbind(phenotypes_kgen.df,phenotypes_ampliseq.df)
table(phenotypes_ampliseq_kgen.df$group)
# Add eigenvectors to phenotypes
eigenphen_ampliseq_kgen.df <- full_join(
phenotypes_ampliseq_kgen.df, eigenvectors.df[,1:6], by="sample")
dim(eigenphen_ampliseq_kgen.df)
head(eigenphen_ampliseq_kgen.df)
tail(eigenphen_ampliseq_kgen.df)
# Clean-up
rm(kg_phenotypes.df, phenotypes_ampliseq.df, phenotypes_ampliseq_kgen.df,
phenotypes.df, phenotypes_kgen.df, eigenvectors.df)
# Chunk 8: ampliseq_1kgp_plot
# Prepare vector fr colour scale
myColours <- c("EUR"="BLUE", "AFR"="YELLOW", "AMR"="GREEN",
"SAS"="GREY", "EAS"="AQUAMARINE",
"UBC"="SALMON", "CBC"="RED")
myColourScale <- scale_colour_manual(values=myColours)
# Static plot
ggplot(eigenphen_ampliseq_kgen.df, aes(PC1,PC2)) +
geom_point(aes(col=group)) +
labs(title="WECARE Ampliseq PCA",
subtitle="based on 622 non-rare variants not in LD", x="PC1", y="PC2") +
geom_vline(xintercept=pc1_th, linetype="dashed", size=0.5) +
geom_hline(yintercept=pc2_th, linetype="dashed", size=0.5) +
myColourScale
# Interactive plot
plotly_group <- factor(eigenphen_ampliseq_kgen.df$group,
levels=c("AFR","AMR","EAS","SAS","EUR","UBC","CBC"))
g <- ggplot(eigenphen_ampliseq_kgen.df, aes(PC1,PC2)) +
geom_point(aes(col=plotly_group, text=sample)) +
labs(title="WECARE Ampliseq PCA", x="PC1", y="PC2") +
theme(legend.title=element_blank()) + # To suppress the legend title, otherwise it would be "plotly_group
geom_vline(xintercept=pc1_th, linetype="dashed", size=0.5) +
geom_hline(yintercept=pc2_th, linetype="dashed", size=0.5) +
myColourScale
ggplotly(g, tooltip="text") # By default the tooltip would also show coordinates
# Clean-up
rm(myColours, myColourScale, plotly_group, g)
# Chunk 9
# Select ampliseq IDs
eigenphen_ampliseq_kgen.df$sample[2504:2505]
ampliseq_ids <- eigenphen_ampliseq_kgen.df$sample[2505:3019]
# Select outliers
pc1_outliers <- eigenphen_ampliseq_kgen.df$PC1 > pc1_th & eigenphen_ampliseq_kgen.df$sample %in% ampliseq_ids
pc2_outliers <- eigenphen_ampliseq_kgen.df$PC2 > pc2_th & eigenphen_ampliseq_kgen.df$sample %in% ampliseq_ids
pca_outliers <- pc1_outliers | pc2_outliers
sum(pc1_outliers)
sum(pc2_outliers)
sum(pca_outliers)
joined_outliers <- eigenphen_ampliseq_kgen.df[pca_outliers,"sample"]
joined_outliers
# Compare with previous list of 48 outliers
previous_outliers <- c("103_S147_L007","11_S358_L008","133_S168_L007","139_S123_L007","141_S158_L007","146_S408_L008","148_S432_L008","16_S109_L007","1_S441_L008","213_S257_L007","235_S535_L008","238_S520_L008","246_S375_L008","248_S188_L007","256_S513_L008","267_S48_L007","273_S150_L007","275_S22_L007","276_S209_L007","277_S292_L008","285_S374_L008","287_S10_L007","289_S69_L007","293_S479_L008","308_S434_L008","313_S362_L008","323_S469_L008","326_S317_L008","329_S373_L008","330_S409_L008","347_S36_L007","352_S435_L008","355_S365_L008","35_S9_L007","366_S293_L008","368_S46_L007","369_S230_L007","372_S340_L008","375_S140_L007","376_S84_L007","381_S277_L008","385_S305_L008","388_S259_L007","3_S360_L008","403_S210_L007","407_S106_L007","408_S130_L007","94_S143_L007")
x <- setdiff(previous_outliers,joined_outliers)
length(x)
x
y <- setdiff(joined_outliers,previous_outliers)
length(y)
y
z <- intersect(previous_outliers,joined_outliers)
length(z)
z
# Clean-up
rm(ampliseq_ids, pc1_outliers, pc2_outliers, pca_outliers, previous_outliers, x,y,z)
# Chunk 10: save
save.image(paste(base_folder, "s01_joined_PCA_plots_622_3019_not_rare_not_in_LD.RData", sep="/"))
# Chunk 11: final_section
ls()
sessionInfo()
Sys.time()
# Chunk 1: set_width
#eval=F
options(width = 999)
# https://stackoverflow.com/questions/36845178/width-of-r-code-chunk-output-in-rmarkdown-files-knitr-ed-to-html
# Chunk 2: start_section
Sys.time()
rm(list=ls())
graphics.off()
library(knitr)
library(dplyr)
library(ggplot2)
library(plotly)
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s12_joined_ampliseq_1kgp_PCA/s06_explore_joined_PCA_plots"
opts_knit$set(root.dir = base_folder)
options(stringsAsFactors = F)
options(warnPartialMatchArgs = T,
warnPartialMatchAttr = T,
warnPartialMatchDollar = T)
#options(error = browser()) # Type Q or c to exit, drop browser level
# https://support.rstudio.com/hc/en-us/articles/200713843?version=1.1.456&mode=desktop
# https://stackoverflow.com/questions/13052522/how-to-leave-the-r-browser-mode-in-the-console-window/13052588
# Chunk 3: read_data
# Sequencing data
source_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s11_remove_BRCA_PALB_carriers"
load(paste(source_folder, "s01_exclude_BRCA1_BCRA2_PALB2_carriers.RData", sep="/"))
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s12_joined_ampliseq_1kgp_PCA/s06_explore_joined_PCA_plots"
# Eigenvectors and eigenvalues
source_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s12_joined_ampliseq_1kgp_PCA/s05_calculate_joined_1kgp_ampliseq_PCs/data/s04_pca"
eigenvectors_file <- paste(source_folder, "ampliseq_1kg_622_3019_100PCs.eigenvec", sep="/")
eigenvectors.df <- read.table(eigenvectors_file, header=T, sep="\t",quote="")
eigenvalues_file <- paste(source_folder, "ampliseq_1kg_622_3019_100PCs.eigenval", sep="/")
eigenvalues.df <- read.table(eigenvalues_file, header=F, sep="\t",quote="")
# IKGP phenotypes
source_folder="/Users/alexey/Documents/resources/1kgp"
kg_phenotypes_file <- paste(source_folder, "integrated_call_samples_v3.20130502.ALL.panel", sep="/")
kg_phenotypes.df <- read.table(kg_phenotypes_file, header=T)
# Thresholds to select outliers
# (manually selected on the basis of visual assessment of plots)
pc1_th <- 0.007
pc2_th <- 0.01
# Clean-up
rm(source_folder, eigenvectors_file, eigenvalues_file, kg_phenotypes_file, genotypes.mx, variants.df)
# Chunk 4: start_check
ls()
dim(eigenvectors.df)
dim(eigenvalues.df)
dim(kg_phenotypes.df)
dim(phenotypes.df)
table(phenotypes.df$cc)
# Chunk 5
eigenvectors.df[1:5,1:5]
rownames(eigenvectors.df) <- eigenvectors.df$FID
eigenvectors.df <- eigenvectors.df[,-1]
"sample" -> colnames(eigenvectors.df)[1]
eigenvectors.df[1:5,1:5]
# Chunk 6: eigenvalues
plot(eigenvalues.df$V1, type="b", ylab="Variance",
main="Top 100 eigenvectors")
plot(eigenvalues.df$V1[1:10], type="b", ylab="Variance",
main="Top 10 eigenvectors")
rm(eigenvalues.df)
# Chunk 7: ampliseq_1kgp
# Check the expected order of samples
eigenvectors.df[c(2504,2505),c("sample","PC1")]
# Prepare phenotypes for ampliseq-kgen data
phenotypes_ampliseq.df <- phenotypes.df[1:515,c("long_ids","cc")]
table(phenotypes_ampliseq.df$cc)
"UBC" -> phenotypes_ampliseq.df$cc[phenotypes_ampliseq.df$cc==0]
"CBC" -> phenotypes_ampliseq.df$cc[phenotypes_ampliseq.df$cc==1]
table(phenotypes_ampliseq.df$cc)
c("sample","group") -> colnames(phenotypes_ampliseq.df)
phenotypes_kgen.df <- kg_phenotypes.df[,c("sample","super_pop")]
c("sample","group") -> colnames(phenotypes_kgen.df)
phenotypes_ampliseq_kgen.df <- rbind(phenotypes_kgen.df,phenotypes_ampliseq.df)
table(phenotypes_ampliseq_kgen.df$group)
# Add eigenvectors to phenotypes
eigenphen_ampliseq_kgen.df <- full_join(
phenotypes_ampliseq_kgen.df, eigenvectors.df[,1:6], by="sample")
dim(eigenphen_ampliseq_kgen.df)
head(eigenphen_ampliseq_kgen.df)
tail(eigenphen_ampliseq_kgen.df)
# Clean-up
rm(kg_phenotypes.df, phenotypes_ampliseq.df, phenotypes_ampliseq_kgen.df,
phenotypes.df, phenotypes_kgen.df, eigenvectors.df)
# Chunk 8: ampliseq_1kgp_plot
# Prepare vector fr colour scale
myColours <- c("EUR"="BLUE", "AFR"="YELLOW", "AMR"="GREEN",
"SAS"="GREY", "EAS"="AQUAMARINE",
"UBC"="SALMON", "CBC"="RED")
myColourScale <- scale_colour_manual(values=myColours)
# Static plot
ggplot(eigenphen_ampliseq_kgen.df, aes(PC1,PC2)) +
geom_point(aes(col=group)) +
labs(title="WECARE Ampliseq PCA",
subtitle="based on 622 non-rare variants not in LD", x="PC1", y="PC2") +
geom_vline(xintercept=pc1_th, linetype="dashed", size=0.5) +
geom_hline(yintercept=pc2_th, linetype="dashed", size=0.5) +
myColourScale
# Interactive plot
plotly_group <- factor(eigenphen_ampliseq_kgen.df$group,
levels=c("AFR","AMR","EAS","SAS","EUR","UBC","CBC"))
g <- ggplot(eigenphen_ampliseq_kgen.df, aes(PC1,PC2)) +
geom_point(aes(col=plotly_group, text=sample)) +
labs(title="WECARE Ampliseq PCA", x="PC1", y="PC2") +
theme(legend.title=element_blank()) + # To suppress the legend title, otherwise it would be "plotly_group
geom_vline(xintercept=pc1_th, linetype="dashed", size=0.5) +
geom_hline(yintercept=pc2_th, linetype="dashed", size=0.5) +
myColourScale
ggplotly(g, tooltip="text") # By default the tooltip would also show coordinates
# Clean-up
rm(myColours, myColourScale, plotly_group, g)
# Chunk 9
# Select ampliseq IDs
eigenphen_ampliseq_kgen.df$sample[2504:2505]
ampliseq_ids <- eigenphen_ampliseq_kgen.df$sample[2505:3019]
# Select outliers
pc1_outliers <- eigenphen_ampliseq_kgen.df$PC1 > pc1_th & eigenphen_ampliseq_kgen.df$sample %in% ampliseq_ids
pc2_outliers <- eigenphen_ampliseq_kgen.df$PC2 > pc2_th & eigenphen_ampliseq_kgen.df$sample %in% ampliseq_ids
pca_outliers <- pc1_outliers | pc2_outliers
sum(pc1_outliers)
sum(pc2_outliers)
sum(pca_outliers)
joined_outliers <- eigenphen_ampliseq_kgen.df[pca_outliers,"sample"]
joined_outliers
# Compare with previous list of 48 outliers
previous_outliers <- c("103_S147_L007","11_S358_L008","133_S168_L007","139_S123_L007","141_S158_L007","146_S408_L008","148_S432_L008","16_S109_L007","1_S441_L008","213_S257_L007","235_S535_L008","238_S520_L008","246_S375_L008","248_S188_L007","256_S513_L008","267_S48_L007","273_S150_L007","275_S22_L007","276_S209_L007","277_S292_L008","285_S374_L008","287_S10_L007","289_S69_L007","293_S479_L008","308_S434_L008","313_S362_L008","323_S469_L008","326_S317_L008","329_S373_L008","330_S409_L008","347_S36_L007","352_S435_L008","355_S365_L008","35_S9_L007","366_S293_L008","368_S46_L007","369_S230_L007","372_S340_L008","375_S140_L007","376_S84_L007","381_S277_L008","385_S305_L008","388_S259_L007","3_S360_L008","403_S210_L007","407_S106_L007","408_S130_L007","94_S143_L007")
x <- setdiff(previous_outliers,joined_outliers)
length(x)
x
y <- setdiff(joined_outliers,previous_outliers)
length(y)
y
z <- intersect(previous_outliers,joined_outliers)
length(z)
z
# Clean-up
rm(ampliseq_ids, pc1_outliers, pc2_outliers, pca_outliers, previous_outliers, x,y,z)
# Chunk 10: save
save.image(paste(base_folder, "s01_joined_PCA_plots_622_3019_not_rare_not_in_LD.RData", sep="/"))
# Chunk 11: final_section
ls()
sessionInfo()
Sys.time()
# Chunk 1: set_width
#eval=F
options(width = 999)
# https://stackoverflow.com/questions/36845178/width-of-r-code-chunk-output-in-rmarkdown-files-knitr-ed-to-html
# Chunk 2: start_section
Sys.time()
rm(list=ls())
graphics.off()
library(knitr)
library(dplyr)
library(ggplot2)
library(plotly)
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s12_joined_ampliseq_1kgp_PCA/s06_explore_joined_PCA_plots"
opts_knit$set(root.dir = base_folder)
options(stringsAsFactors = F)
options(warnPartialMatchArgs = T,
warnPartialMatchAttr = T,
warnPartialMatchDollar = T)
#options(error = browser()) # Type Q or c to exit, drop browser level
# https://support.rstudio.com/hc/en-us/articles/200713843?version=1.1.456&mode=desktop
# https://stackoverflow.com/questions/13052522/how-to-leave-the-r-browser-mode-in-the-console-window/13052588
# Chunk 3: read_data
# Sequencing data
source_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s11_remove_BRCA_PALB_carriers"
load(paste(source_folder, "s01_exclude_BRCA1_BCRA2_PALB2_carriers.RData", sep="/"))
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s12_joined_ampliseq_1kgp_PCA/s06_explore_joined_PCA_plots"
# Eigenvectors and eigenvalues
source_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s12_joined_ampliseq_1kgp_PCA/s05_calculate_joined_1kgp_ampliseq_PCs/data/s04_pca"
eigenvectors_file <- paste(source_folder, "ampliseq_1kg_622_3019_100PCs.eigenvec", sep="/")
eigenvectors.df <- read.table(eigenvectors_file, header=T, sep="\t",quote="")
eigenvalues_file <- paste(source_folder, "ampliseq_1kg_622_3019_100PCs.eigenval", sep="/")
eigenvalues.df <- read.table(eigenvalues_file, header=F, sep="\t",quote="")
# IKGP phenotypes
source_folder="/Users/alexey/Documents/resources/1kgp"
kg_phenotypes_file <- paste(source_folder, "integrated_call_samples_v3.20130502.ALL.panel", sep="/")
kg_phenotypes.df <- read.table(kg_phenotypes_file, header=T)
# Thresholds to select outliers
# (manually selected on the basis of visual assessment of plots)
pc1_th <- 0.007
pc2_th <- 0.009
# Clean-up
rm(source_folder, eigenvectors_file, eigenvalues_file, kg_phenotypes_file, genotypes.mx, variants.df)
# Chunk 4: start_check
ls()
dim(eigenvectors.df)
dim(eigenvalues.df)
dim(kg_phenotypes.df)
dim(phenotypes.df)
table(phenotypes.df$cc)
# Chunk 5
eigenvectors.df[1:5,1:5]
rownames(eigenvectors.df) <- eigenvectors.df$FID
eigenvectors.df <- eigenvectors.df[,-1]
"sample" -> colnames(eigenvectors.df)[1]
eigenvectors.df[1:5,1:5]
# Chunk 6: eigenvalues
plot(eigenvalues.df$V1, type="b", ylab="Variance",
main="Top 100 eigenvectors")
plot(eigenvalues.df$V1[1:10], type="b", ylab="Variance",
main="Top 10 eigenvectors")
rm(eigenvalues.df)
# Chunk 7: ampliseq_1kgp
# Check the expected order of samples
eigenvectors.df[c(2504,2505),c("sample","PC1")]
# Prepare phenotypes for ampliseq-kgen data
phenotypes_ampliseq.df <- phenotypes.df[1:515,c("long_ids","cc")]
table(phenotypes_ampliseq.df$cc)
"UBC" -> phenotypes_ampliseq.df$cc[phenotypes_ampliseq.df$cc==0]
"CBC" -> phenotypes_ampliseq.df$cc[phenotypes_ampliseq.df$cc==1]
table(phenotypes_ampliseq.df$cc)
c("sample","group") -> colnames(phenotypes_ampliseq.df)
phenotypes_kgen.df <- kg_phenotypes.df[,c("sample","super_pop")]
c("sample","group") -> colnames(phenotypes_kgen.df)
phenotypes_ampliseq_kgen.df <- rbind(phenotypes_kgen.df,phenotypes_ampliseq.df)
table(phenotypes_ampliseq_kgen.df$group)
# Add eigenvectors to phenotypes
eigenphen_ampliseq_kgen.df <- full_join(
phenotypes_ampliseq_kgen.df, eigenvectors.df[,1:6], by="sample")
dim(eigenphen_ampliseq_kgen.df)
head(eigenphen_ampliseq_kgen.df)
tail(eigenphen_ampliseq_kgen.df)
# Clean-up
rm(kg_phenotypes.df, phenotypes_ampliseq.df, phenotypes_ampliseq_kgen.df,
phenotypes.df, phenotypes_kgen.df, eigenvectors.df)
# Chunk 8: ampliseq_1kgp_plot
# Prepare vector fr colour scale
myColours <- c("EUR"="BLUE", "AFR"="YELLOW", "AMR"="GREEN",
"SAS"="GREY", "EAS"="AQUAMARINE",
"UBC"="SALMON", "CBC"="RED")
myColourScale <- scale_colour_manual(values=myColours)
# Static plot
ggplot(eigenphen_ampliseq_kgen.df, aes(PC1,PC2)) +
geom_point(aes(col=group)) +
labs(title="WECARE Ampliseq PCA",
subtitle="based on 622 non-rare variants not in LD", x="PC1", y="PC2") +
geom_vline(xintercept=pc1_th, linetype="dashed", size=0.5) +
geom_hline(yintercept=pc2_th, linetype="dashed", size=0.5) +
myColourScale
# Interactive plot
plotly_group <- factor(eigenphen_ampliseq_kgen.df$group,
levels=c("AFR","AMR","EAS","SAS","EUR","UBC","CBC"))
g <- ggplot(eigenphen_ampliseq_kgen.df, aes(PC1,PC2)) +
geom_point(aes(col=plotly_group, text=sample)) +
labs(title="WECARE Ampliseq PCA", x="PC1", y="PC2") +
theme(legend.title=element_blank()) + # To suppress the legend title, otherwise it would be "plotly_group
geom_vline(xintercept=pc1_th, linetype="dashed", size=0.5) +
geom_hline(yintercept=pc2_th, linetype="dashed", size=0.5) +
myColourScale
ggplotly(g, tooltip="text") # By default the tooltip would also show coordinates
# Clean-up
rm(myColours, myColourScale, plotly_group, g)
# Chunk 9
# Select ampliseq IDs
eigenphen_ampliseq_kgen.df$sample[2504:2505]
ampliseq_ids <- eigenphen_ampliseq_kgen.df$sample[2505:3019]
# Select outliers
pc1_outliers <- eigenphen_ampliseq_kgen.df$PC1 > pc1_th & eigenphen_ampliseq_kgen.df$sample %in% ampliseq_ids
pc2_outliers <- eigenphen_ampliseq_kgen.df$PC2 > pc2_th & eigenphen_ampliseq_kgen.df$sample %in% ampliseq_ids
pca_outliers <- pc1_outliers | pc2_outliers
sum(pc1_outliers)
sum(pc2_outliers)
sum(pca_outliers)
joined_outliers <- eigenphen_ampliseq_kgen.df[pca_outliers,"sample"]
joined_outliers
# Compare with previous list of 48 outliers
previous_outliers <- c("103_S147_L007","11_S358_L008","133_S168_L007","139_S123_L007","141_S158_L007","146_S408_L008","148_S432_L008","16_S109_L007","1_S441_L008","213_S257_L007","235_S535_L008","238_S520_L008","246_S375_L008","248_S188_L007","256_S513_L008","267_S48_L007","273_S150_L007","275_S22_L007","276_S209_L007","277_S292_L008","285_S374_L008","287_S10_L007","289_S69_L007","293_S479_L008","308_S434_L008","313_S362_L008","323_S469_L008","326_S317_L008","329_S373_L008","330_S409_L008","347_S36_L007","352_S435_L008","355_S365_L008","35_S9_L007","366_S293_L008","368_S46_L007","369_S230_L007","372_S340_L008","375_S140_L007","376_S84_L007","381_S277_L008","385_S305_L008","388_S259_L007","3_S360_L008","403_S210_L007","407_S106_L007","408_S130_L007","94_S143_L007")
x <- setdiff(previous_outliers,joined_outliers)
length(x)
x
y <- setdiff(joined_outliers,previous_outliers)
length(y)
y
z <- intersect(previous_outliers,joined_outliers)
length(z)
z
# Clean-up
rm(ampliseq_ids, pc1_outliers, pc2_outliers, pca_outliers, previous_outliers, x,y,z)
# Chunk 10: save
save.image(paste(base_folder, "s01_joined_PCA_plots_622_3019_not_rare_not_in_LD.RData", sep="/"))
# Chunk 11: final_section
ls()
sessionInfo()
Sys.time()
# Chunk 1: set_width
#eval=F
options(width = 999)
# https://stackoverflow.com/questions/36845178/width-of-r-code-chunk-output-in-rmarkdown-files-knitr-ed-to-html
# Chunk 2: start_section
Sys.time()
rm(list=ls())
graphics.off()
library(knitr)
library(dplyr)
library(ggplot2)
library(plotly)
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s12_joined_ampliseq_1kgp_PCA/s06_explore_joined_PCA_plots"
opts_knit$set(root.dir = base_folder)
options(stringsAsFactors = F)
options(warnPartialMatchArgs = T,
warnPartialMatchAttr = T,
warnPartialMatchDollar = T)
#options(error = browser()) # Type Q or c to exit, drop browser level
# https://support.rstudio.com/hc/en-us/articles/200713843?version=1.1.456&mode=desktop
# https://stackoverflow.com/questions/13052522/how-to-leave-the-r-browser-mode-in-the-console-window/13052588
# Chunk 3: read_data
# Sequencing data
source_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s11_remove_BRCA_PALB_carriers"
load(paste(source_folder, "s01_exclude_BRCA1_BCRA2_PALB2_carriers.RData", sep="/"))
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s12_joined_ampliseq_1kgp_PCA/s06_explore_joined_PCA_plots"
# Eigenvectors and eigenvalues
source_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s12_joined_ampliseq_1kgp_PCA/s05_calculate_joined_1kgp_ampliseq_PCs/data/s04_pca"
eigenvectors_file <- paste(source_folder, "ampliseq_1kg_622_3019_100PCs.eigenvec", sep="/")
eigenvectors.df <- read.table(eigenvectors_file, header=T, sep="\t",quote="")
eigenvalues_file <- paste(source_folder, "ampliseq_1kg_622_3019_100PCs.eigenval", sep="/")
eigenvalues.df <- read.table(eigenvalues_file, header=F, sep="\t",quote="")
# IKGP phenotypes
source_folder="/Users/alexey/Documents/resources/1kgp"
kg_phenotypes_file <- paste(source_folder, "integrated_call_samples_v3.20130502.ALL.panel", sep="/")
kg_phenotypes.df <- read.table(kg_phenotypes_file, header=T)
# Thresholds to select outliers
# (manually selected on the basis of visual assessment of plots)
pc1_th <- 0.006
pc2_th <- 0.009
# Clean-up
rm(source_folder, eigenvectors_file, eigenvalues_file, kg_phenotypes_file, genotypes.mx, variants.df)
# Chunk 4: start_check
ls()
dim(eigenvectors.df)
dim(eigenvalues.df)
dim(kg_phenotypes.df)
dim(phenotypes.df)
table(phenotypes.df$cc)
# Chunk 5
eigenvectors.df[1:5,1:5]
rownames(eigenvectors.df) <- eigenvectors.df$FID
eigenvectors.df <- eigenvectors.df[,-1]
"sample" -> colnames(eigenvectors.df)[1]
eigenvectors.df[1:5,1:5]
# Chunk 6: eigenvalues
plot(eigenvalues.df$V1, type="b", ylab="Variance",
main="Top 100 eigenvectors")
plot(eigenvalues.df$V1[1:10], type="b", ylab="Variance",
main="Top 10 eigenvectors")
rm(eigenvalues.df)
# Chunk 7: ampliseq_1kgp
# Check the expected order of samples
eigenvectors.df[c(2504,2505),c("sample","PC1")]
# Prepare phenotypes for ampliseq-kgen data
phenotypes_ampliseq.df <- phenotypes.df[1:515,c("long_ids","cc")]
table(phenotypes_ampliseq.df$cc)
"UBC" -> phenotypes_ampliseq.df$cc[phenotypes_ampliseq.df$cc==0]
"CBC" -> phenotypes_ampliseq.df$cc[phenotypes_ampliseq.df$cc==1]
table(phenotypes_ampliseq.df$cc)
c("sample","group") -> colnames(phenotypes_ampliseq.df)
phenotypes_kgen.df <- kg_phenotypes.df[,c("sample","super_pop")]
c("sample","group") -> colnames(phenotypes_kgen.df)
phenotypes_ampliseq_kgen.df <- rbind(phenotypes_kgen.df,phenotypes_ampliseq.df)
table(phenotypes_ampliseq_kgen.df$group)
# Add eigenvectors to phenotypes
eigenphen_ampliseq_kgen.df <- full_join(
phenotypes_ampliseq_kgen.df, eigenvectors.df[,1:6], by="sample")
dim(eigenphen_ampliseq_kgen.df)
head(eigenphen_ampliseq_kgen.df)
tail(eigenphen_ampliseq_kgen.df)
# Clean-up
rm(kg_phenotypes.df, phenotypes_ampliseq.df, phenotypes_ampliseq_kgen.df,
phenotypes.df, phenotypes_kgen.df, eigenvectors.df)
# Chunk 8: ampliseq_1kgp_plot
# Prepare vector fr colour scale
myColours <- c("EUR"="BLUE", "AFR"="YELLOW", "AMR"="GREEN",
"SAS"="GREY", "EAS"="AQUAMARINE",
"UBC"="SALMON", "CBC"="RED")
myColourScale <- scale_colour_manual(values=myColours)
# Static plot
ggplot(eigenphen_ampliseq_kgen.df, aes(PC1,PC2)) +
geom_point(aes(col=group)) +
labs(title="WECARE Ampliseq PCA",
subtitle="based on 622 non-rare variants not in LD", x="PC1", y="PC2") +
geom_vline(xintercept=pc1_th, linetype="dashed", size=0.5) +
geom_hline(yintercept=pc2_th, linetype="dashed", size=0.5) +
myColourScale
# Interactive plot
plotly_group <- factor(eigenphen_ampliseq_kgen.df$group,
levels=c("AFR","AMR","EAS","SAS","EUR","UBC","CBC"))
g <- ggplot(eigenphen_ampliseq_kgen.df, aes(PC1,PC2)) +
geom_point(aes(col=plotly_group, text=sample)) +
labs(title="WECARE Ampliseq PCA", x="PC1", y="PC2") +
theme(legend.title=element_blank()) + # To suppress the legend title, otherwise it would be "plotly_group
geom_vline(xintercept=pc1_th, linetype="dashed", size=0.5) +
geom_hline(yintercept=pc2_th, linetype="dashed", size=0.5) +
myColourScale
ggplotly(g, tooltip="text") # By default the tooltip would also show coordinates
# Clean-up
rm(myColours, myColourScale, plotly_group, g)
# Chunk 9
# Select ampliseq IDs
eigenphen_ampliseq_kgen.df$sample[2504:2505]
ampliseq_ids <- eigenphen_ampliseq_kgen.df$sample[2505:3019]
# Select outliers
pc1_outliers <- eigenphen_ampliseq_kgen.df$PC1 > pc1_th & eigenphen_ampliseq_kgen.df$sample %in% ampliseq_ids
pc2_outliers <- eigenphen_ampliseq_kgen.df$PC2 > pc2_th & eigenphen_ampliseq_kgen.df$sample %in% ampliseq_ids
pca_outliers <- pc1_outliers | pc2_outliers
sum(pc1_outliers)
sum(pc2_outliers)
sum(pca_outliers)
joined_outliers <- eigenphen_ampliseq_kgen.df[pca_outliers,"sample"]
joined_outliers
# Compare with previous list of 48 outliers
previous_outliers <- c("103_S147_L007","11_S358_L008","133_S168_L007","139_S123_L007","141_S158_L007","146_S408_L008","148_S432_L008","16_S109_L007","1_S441_L008","213_S257_L007","235_S535_L008","238_S520_L008","246_S375_L008","248_S188_L007","256_S513_L008","267_S48_L007","273_S150_L007","275_S22_L007","276_S209_L007","277_S292_L008","285_S374_L008","287_S10_L007","289_S69_L007","293_S479_L008","308_S434_L008","313_S362_L008","323_S469_L008","326_S317_L008","329_S373_L008","330_S409_L008","347_S36_L007","352_S435_L008","355_S365_L008","35_S9_L007","366_S293_L008","368_S46_L007","369_S230_L007","372_S340_L008","375_S140_L007","376_S84_L007","381_S277_L008","385_S305_L008","388_S259_L007","3_S360_L008","403_S210_L007","407_S106_L007","408_S130_L007","94_S143_L007")
x <- setdiff(previous_outliers,joined_outliers)
length(x)
x
y <- setdiff(joined_outliers,previous_outliers)
length(y)
y
z <- intersect(previous_outliers,joined_outliers)
length(z)
z
# Clean-up
rm(ampliseq_ids, pc1_outliers, pc2_outliers, pca_outliers, previous_outliers, x,y,z)
# Chunk 10: save
save.image(paste(base_folder, "s01_joined_PCA_plots_622_3019_not_rare_not_in_LD.RData", sep="/"))
# Chunk 11: final_section
ls()
sessionInfo()
Sys.time()
