---
title: "s01_exclude_BRCA1_BCRA2_PALB2_carriers"
output: html_document
editor_options: 
  chunk_output_type: console
---

started: AL11Jan2019  
last updated: AL30Sep2019  

# Summary  

Previous analysis identified 3 carriers of LoF variants 
in BRCA1, BRCA2 or PALB2 in this ampliseq-nfe data:  

BRCA1 Var000011226 48_S416_L008  
BRCA1 Var000011231 137_S323_L008  
BRCA2 Var000008259 140_S394_L008  

3 more PALB-2 carriers had been identifyed in ampliseq in another 
version of analysis (analysis v.3):  

PALB2	377_S279_L008  
PALB2	311_S137_L007  
PALB2	317_S174_L007  

For safety margin, all 6 samples are excluded.
None of these samples came from the Danish cohort, 
where the concent did not allow assessment of BRCA1/2

46 uniform variants excluded after the samples filtering  

Input data: 3,721 vars x 521 samples (260UBC + 261CBC)  
Output data: 3,675 vars x 515 samples (258UBC + 257CBC)  

# start_section

<style>
pre {
  overflow-x: auto;
}
pre code {
  word-wrap: normal;
  white-space: pre;
}
</style>

```{r set_width, echo=F}

#eval=F

options(width = 999)
# https://stackoverflow.com/questions/36845178/width-of-r-code-chunk-output-in-rmarkdown-files-knitr-ed-to-html

```

```{r start_section}

Sys.time()
rm(list=ls())
graphics.off()

library(knitr)
library(dplyr)

base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s11_remove_BRCA_PALB_carriers"

opts_knit$set(root.dir = base_folder)

options(stringsAsFactors = F)
options(warnPartialMatchArgs = T, 
        warnPartialMatchAttr = T, 
        warnPartialMatchDollar = T)

#options(error = browser()) # Type Q or c to exit, drop browser level
# https://support.rstudio.com/hc/en-us/articles/200713843?version=1.1.456&mode=desktop
# https://stackoverflow.com/questions/13052522/how-to-leave-the-r-browser-mode-in-the-console-window/13052588 

```

# read_data  

```{r read_data}

source_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s10_remove_duplicates"
load(paste(source_folder, "s02_remove_duplicates.RData", sep="/"))
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s11_remove_BRCA_PALB_carriers"
rm(source_folder)

```

# Check data

```{r start_check}

ls()
dim(genotypes.mx)
dim(phenotypes.df)
dim(variants.df)
sum(colnames(genotypes.mx) != rownames(phenotypes.df))
sum(rownames(genotypes.mx) != rownames(variants.df))

```

# List of samples to exclude  

```{r carriers_list}

BRCA_PALB_carriers <- c("48_S416_L008","137_S323_L008","140_S394_L008",
                        "311_S137_L007", "317_S174_L007", "377_S279_L008") 

```

# Exclude the carriers

```{r exclude_carriers}

selected_cases <- ! colnames(genotypes.mx) %in% BRCA_PALB_carriers
genotypes.mx <- genotypes.mx[,selected_cases]
phenotypes.df <- phenotypes.df[selected_cases,]

rm(selected_cases, BRCA_PALB_carriers)

```

# Remove variants with uniform genotypes

```{r update_variants}

# Function to detect uniform numeric vectors
uniform.udf <- function(x){
  if(all(is.na(x))) return(TRUE) # Return T if all are NA
  min(x,na.rm=T)==max(x,na.rm=T)} # Return T if min=max, otherwise return F

# Make the filter
uniform_vars <- apply(genotypes.mx,1,uniform.udf)
sum(uniform_vars)

# Apply filter
variants.df <- variants.df[!uniform_vars,]
genotypes.mx <- genotypes.mx[!uniform_vars,]

# Clean-up
rm(uniform.udf, uniform_vars)

```

# Check data

```{r end_check}

dim(genotypes.mx)
dim(phenotypes.df)
dim(variants.df)
sum(colnames(genotypes.mx) != rownames(phenotypes.df))
sum(rownames(genotypes.mx) != rownames(variants.df))

table(phenotypes.df$cc)

```

# Save results

```{r save_results}

save.image(paste(base_folder, "s01_exclude_BRCA1_BCRA2_PALB2_carriers.RData", sep="/"))

```

# final_section

```{r final_section}

ls()
sessionInfo()
Sys.time()

```
