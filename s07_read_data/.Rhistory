Sys.time()
rm(list=ls())
graphics.off()
library(knitr)
library(dplyr)
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s07_read_data"
opts_knit$set(root.dir = base_folder)
options(stringsAsFactors = F)
options(warnPartialMatchArgs = T,
warnPartialMatchAttr = T,
warnPartialMatchDollar = T)
#options(error = browser()) # Type Q or c to exit, drop browser level
# https://support.rstudio.com/hc/en-us/articles/200713843?version=1.1.456&mode=desktop
# https://stackoverflow.com/questions/13052522/how-to-leave-the-r-browser-mode-in-the-console-window/13052588
data_folder="/Users/alexey/Documents/wecare/ampliseq/v04_ampliseq_nfe/s06_read_vcf_to_r"
load(paste(data_folder, "s01_read_vcf_to_r.RData", sep="/"))
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s07_read_data"
ad.mx[1:5,1:5]
rm(data_folder, ad.mx)
# Phenotype data
phenotypes_2018_file <- paste(base_folder, "phenotypes_dec2018.txt", sep="/")
phenotypes_2018.df <- read.table(phenotypes_2018_file, header=T, sep="\t", quote="")
# Phenotype data
phenotypes_2018_file <- paste(data_folder, "phenotypes_dec2018.txt", sep="/")
data_folder="/Users/alexey/Documents/wecare/ampliseq/v04_ampliseq_nfe/phenotypes"
# Phenotype data
phenotypes_2018_file <- paste(data_folder, "phenotypes_dec2018.txt", sep="/")
phenotypes_2018.df <- read.table(phenotypes_2018_file, header=T, sep="\t", quote="")
data_folder="/Users/alexey/Documents/wecare/ampliseq/v04_ampliseq_nfe/s05_phenotypes"
# Phenotype data
phenotypes_2018_file <- paste(data_folder, "phenotypes_dec2018.txt", sep="/")
phenotypes_2018.df <- read.table(phenotypes_2018_file, header=T, sep="\t", quote="")
phenotypes_2019_file <- paste(data_folder, "phenotypes_jan2019.txt", sep="/")
phenotypes_2019.df <- read.table(phenotypes_2019_file, header=T, sep="\t", quote="")
# Clean-up
rm(phenotypes_2018_file, phenotypes_2019_file, data_folder)
dim(phenotypes_2018.df)
dim(phenotypes_2019.df)
sum(is.na(phenotypes_2018.df))
sum(is.na(phenotypes_2019.df))
colnames(phenotypes_2018.df)
colnames(phenotypes_2019.df)
identical_fields <- colnames(phenotypes_2018.df)
sum(phenotypes_2018.df[,identical_fields] != phenotypes_2019.df[,identical_fields])
rm(identical_fields)
identical_fields <- colnames(phenotypes_2018.df)
sum(phenotypes_2018.df[,identical_fields] != phenotypes_2019.df[,identical_fields])
new_fields <- colnames(phenotypes_2019.df)[colnames(phenotypes_2019.df) !%in% identical_fields]
new_fields <- colnames(phenotypes_2019.df)[! colnames(phenotypes_2019.df) %in% identical_fields]
colnames(phenotypes_2019.df)[! colnames(phenotypes_2019.df) %in% identical_fields]
# No missed data
sum(is.na(phenotypes_2018.df))
sum(is.na(phenotypes_2019.df))
variants.df <- vars.df
genotypes.mx <- gt.mx
wecare_phenotypes.df <- phenotypes_2019.df
phenotypes.df <- phenotypes_2019.df
library(vcfR) # for reading VCF with samples names
library(tidyr) # for separate (samples names parsing)
library(knitr)
library(dplyr)
dim(mx)
dim(gt.mx)
dim(gt_num.mx)
gt_num.mx[1:5,1:5]
dim(gt_add.mx)
gt_add.mx[1:5,1:5]
rm(data_folder, ad.mx, gt_chr.mx, gt_num.mx)
# Chunk 1: set_width
#eval=F
options(width = 999)
# https://stackoverflow.com/questions/36845178/width-of-r-code-chunk-output-in-rmarkdown-files-knitr-ed-to-html
# Chunk 2: start_section
Sys.time()
rm(list=ls())
graphics.off()
library(knitr)
library(dplyr)
library(vcfR) # for reading VCF with samples names
library(tidyr) # for separate (samples names parsing)
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s07_read_data"
opts_knit$set(root.dir = base_folder)
options(stringsAsFactors = F)
options(warnPartialMatchArgs = T,
warnPartialMatchAttr = T,
warnPartialMatchDollar = T)
#options(error = browser()) # Type Q or c to exit, drop browser level
# https://support.rstudio.com/hc/en-us/articles/200713843?version=1.1.456&mode=desktop
# https://stackoverflow.com/questions/13052522/how-to-leave-the-r-browser-mode-in-the-console-window/13052588
# Chunk 3
data_folder="/Users/alexey/Documents/wecare/ampliseq/v04_ampliseq_nfe/s06_read_vcf_to_r"
load(paste(data_folder, "s01_read_vcf_to_r.RData", sep="/"))
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s07_read_data"
rm(data_folder, ad.mx, gt_chr.mx, gt_num.mx)
# Chunk 4: read_data
data_folder="/Users/alexey/Documents/wecare/ampliseq/v04_ampliseq_nfe/s05_phenotypes"
# Phenotype data
phenotypes_2018_file <- paste(data_folder, "phenotypes_dec2018.txt", sep="/")
phenotypes_2018.df <- read.table(phenotypes_2018_file, header=T, sep="\t", quote="")
phenotypes_2019_file <- paste(data_folder, "phenotypes_jan2019.txt", sep="/")
phenotypes_2019.df <- read.table(phenotypes_2019_file, header=T, sep="\t", quote="")
# Clean-up
rm(phenotypes_2018_file, phenotypes_2019_file, data_folder)
# Chunk 5: compare_phenotypes
# Data sizes
dim(phenotypes_2018.df)
dim(phenotypes_2019.df)
# No missed data in both phenotype versions
sum(is.na(phenotypes_2018.df))
sum(is.na(phenotypes_2019.df))
# Avaiable annotations
colnames(phenotypes_2018.df)
colnames(phenotypes_2019.df)
# All fields of 2018 are present in 2019 and the data is the same
identical_fields <- colnames(phenotypes_2018.df)
sum(phenotypes_2018.df[,identical_fields] != phenotypes_2019.df[,identical_fields])
# New fields in 2019 data
colnames(phenotypes_2019.df)[! colnames(phenotypes_2019.df) %in% identical_fields]
# Keep only 2019 phenotype data
phenotypes.df <- phenotypes_2019.df
# Clean-up
rm(identical_fields, phenotypes_2018.df)
gt.mx <- gt_add.mx
rm(data_folder, ad.mx, gt_chr.mx, gt_num.mx,gt_add.mx)
# Chunk 1: set_width
#eval=F
options(width = 999)
# https://stackoverflow.com/questions/36845178/width-of-r-code-chunk-output-in-rmarkdown-files-knitr-ed-to-html
# Chunk 2: start_section
Sys.time()
rm(list=ls())
graphics.off()
library(knitr)
library(dplyr)
library(vcfR) # for reading VCF with samples names
library(tidyr) # for separate (samples names parsing)
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s07_read_data"
opts_knit$set(root.dir = base_folder)
options(stringsAsFactors = F)
options(warnPartialMatchArgs = T,
warnPartialMatchAttr = T,
warnPartialMatchDollar = T)
#options(error = browser()) # Type Q or c to exit, drop browser level
# https://support.rstudio.com/hc/en-us/articles/200713843?version=1.1.456&mode=desktop
# https://stackoverflow.com/questions/13052522/how-to-leave-the-r-browser-mode-in-the-console-window/13052588
# Chunk 3
data_folder="/Users/alexey/Documents/wecare/ampliseq/v04_ampliseq_nfe/s06_read_vcf_to_r"
load(paste(data_folder, "s01_read_vcf_to_r.RData", sep="/"))
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s07_read_data"
genotypes.mx <- gt_add.mx
variants.df <- fixed.df
rm(data_folder, ad.mx, gt_chr.mx, gt_num.mx,gt_add.mx,fixed.df)
# Chunk 4: read_data
data_folder="/Users/alexey/Documents/wecare/ampliseq/v04_ampliseq_nfe/s05_phenotypes"
# Phenotype data
phenotypes_2018_file <- paste(data_folder, "phenotypes_dec2018.txt", sep="/")
phenotypes_2018.df <- read.table(phenotypes_2018_file, header=T, sep="\t", quote="")
phenotypes_2019_file <- paste(data_folder, "phenotypes_jan2019.txt", sep="/")
phenotypes_2019.df <- read.table(phenotypes_2019_file, header=T, sep="\t", quote="")
# Clean-up
rm(phenotypes_2018_file, phenotypes_2019_file, data_folder)
# Chunk 5: compare_phenotypes
# Data sizes
dim(phenotypes_2018.df)
dim(phenotypes_2019.df)
# No missed data in both phenotype versions
sum(is.na(phenotypes_2018.df))
sum(is.na(phenotypes_2019.df))
# Avaiable annotations
colnames(phenotypes_2018.df)
colnames(phenotypes_2019.df)
# All fields of 2018 are present in 2019 and the data is the same
identical_fields <- colnames(phenotypes_2018.df)
sum(phenotypes_2018.df[,identical_fields] != phenotypes_2019.df[,identical_fields])
# New fields in 2019 data
colnames(phenotypes_2019.df)[! colnames(phenotypes_2019.df) %in% identical_fields]
# Keep only 2019 phenotype data
phenotypes.df <- phenotypes_2019.df
# Clean-up
rm(identical_fields, phenotypes_2018.df)
# Clean-up
rm(identical_fields, phenotypes_2018.df, phenotypes_2019.df)
dim(genotypes.mx)
genotypes.mx[1:5,1:5]
genotypes.mx[1:5,541:542]
genotypes.mx[1:5,735:739]
wecare_samples.df <- data.frame(long_ids=colnames(genotypes.mx)[1:541])
nfe_samples.df <- data.frame(long_ids=colnames(genotypes.mx)[542:739])
# Split the long IDs for wecare samples
wecare_samples.df <- separate(wecare_samples.df, "long_ids", c("num", "illumina_id", "illumina_lane"),
sep="_", remove=F)
View(wecare_samples.df)
wecare_samples.df$num <- as.integer(wecare_samples.df$num)
dim(wecare_samples.df)
str(wecare_samples.df)
wecare_samples.df[1:5,]
# Sort wecare_samples.df by sample num (to sync with phenotypes.df)
wecare_samples.df <- wecare_samples.df[order(wecare_samples.df$num),]
wecare_samples.df[1:5,]
wecare_phenotypes.df[1:5,1:5]
phenotypes.df[1:5,1:5]
# Bind add long IDs to phenotypes table
wecare_phenotypes.df <- cbind(wecare_samples.df, wecare_phenotypes.df)
# Bind add long IDs to phenotypes table
phenotypes.df <- cbind(wecare_samples.df, phenotypes.df)
# Check that numbers are identical
sum(wecare_phenotypes.df$num == wecare_phenotypes.df$Sample_num)
# Check that numbers are identical
sum(phenotypes.df$num == phenotypes.df$Sample_num)
sum(phenotypes.df$num != phenotypes.df$Sample_num)
# Remove one of the numbers
wecare_phenotypes.df <- wecare_phenotypes.df[,-2]
# Remove one of the numbers
phenotypes.df <- phenotypes.df[,-2]
dim(phenotypes.df)
colnames(phenotypes.df)
str(phenotypes.df)
# Set rownames
rownames(phenotypes.df) <- phenotypes.df$long_ids
# Chunk 1: set_width
#eval=F
options(width = 999)
# https://stackoverflow.com/questions/36845178/width-of-r-code-chunk-output-in-rmarkdown-files-knitr-ed-to-html
# Chunk 2: start_section
Sys.time()
rm(list=ls())
graphics.off()
library(knitr)
library(dplyr)
library(tidyr) # for separate (samples names parsing)
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s07_read_data"
opts_knit$set(root.dir = base_folder)
options(stringsAsFactors = F)
options(warnPartialMatchArgs = T,
warnPartialMatchAttr = T,
warnPartialMatchDollar = T)
#options(error = browser()) # Type Q or c to exit, drop browser level
# https://support.rstudio.com/hc/en-us/articles/200713843?version=1.1.456&mode=desktop
# https://stackoverflow.com/questions/13052522/how-to-leave-the-r-browser-mode-in-the-console-window/13052588
# Chunk 3
data_folder="/Users/alexey/Documents/wecare/ampliseq/v04_ampliseq_nfe/s06_read_vcf_to_r"
load(paste(data_folder, "s01_read_vcf_to_r.RData", sep="/"))
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s07_read_data"
genotypes.mx <- gt_add.mx
variants.df <- fixed.df
rm(data_folder, ad.mx, gt_chr.mx, gt_num.mx,gt_add.mx,fixed.df)
# Chunk 4: read_data
data_folder="/Users/alexey/Documents/wecare/ampliseq/v04_ampliseq_nfe/s05_phenotypes"
# Phenotype data
phenotypes_2018_file <- paste(data_folder, "phenotypes_dec2018.txt", sep="/")
phenotypes_2018.df <- read.table(phenotypes_2018_file, header=T, sep="\t", quote="")
phenotypes_2019_file <- paste(data_folder, "phenotypes_jan2019.txt", sep="/")
phenotypes_2019.df <- read.table(phenotypes_2019_file, header=T, sep="\t", quote="")
# Clean-up
rm(phenotypes_2018_file, phenotypes_2019_file, data_folder)
# Chunk 5: compare_phenotypes
# Data sizes
dim(phenotypes_2018.df)
dim(phenotypes_2019.df)
# No missed data in both phenotype versions
sum(is.na(phenotypes_2018.df))
sum(is.na(phenotypes_2019.df))
# Avaiable annotations
colnames(phenotypes_2018.df)
colnames(phenotypes_2019.df)
# All fields of 2018 are present in 2019 and the data is the same
identical_fields <- colnames(phenotypes_2018.df)
sum(phenotypes_2018.df[,identical_fields] != phenotypes_2019.df[,identical_fields])
# New fields in 2019 data
colnames(phenotypes_2019.df)[! colnames(phenotypes_2019.df) %in% identical_fields]
# Keep only 2019 phenotype data
phenotypes.df <- phenotypes_2019.df
# Clean-up
rm(identical_fields, phenotypes_2018.df, phenotypes_2019.df)
# Get long samples names from the colnames of genotypes matrix
dim(genotypes.mx)
genotypes.mx[1:5,1:5]
genotypes.mx[1:5,541:542]
genotypes.mx[1:5,735:739]
wecare_samples.df <- data.frame(long_ids=colnames(genotypes.mx)[1:541])
# Split the long IDs for wecare samples
wecare_samples.df <- separate(wecare_samples.df, "long_ids", c("num", "illumina_id", "illumina_lane"),
sep="_", remove=F)
wecare_samples.df$num <- as.integer(wecare_samples.df$num)
dim(wecare_samples.df)
str(wecare_samples.df)
wecare_samples.df[1:5,]
# Sort wecare_samples.df by sample num (to sync with phenotypes.df)
wecare_samples.df <- wecare_samples.df[order(wecare_samples.df$num),]
wecare_samples.df[1:5,]
phenotypes.df[1:5,1:5]
# Bind add long IDs to phenotypes table
phenotypes.df <- cbind(wecare_samples.df, phenotypes.df)
# Check that numbers are identical
sum(phenotypes.df$num == phenotypes.df$Sample_num)
sum(phenotypes.df$num != phenotypes.df$Sample_num)
# Remove one of the numbers
phenotypes.df <- phenotypes.df[,-2]
dim(phenotypes.df)
colnames(phenotypes.df)
str(phenotypes.df)
# Set rownames
rownames(phenotypes.df) <- phenotypes.df$long_ids
# Clean-up
rm(wecare_samples.df)
samples <- rownames(phenotypes.df)
wecare_samples <- rownames(phenotypes.df)
rm(samples)
genotypes.mx <- genotypes.mx[,wecare_samples]
View(variants.df)
rm(data_folder, ad.mx, gt_chr.mx, gt_num.mx,gt_add.mx,fixed.df,meta.df)
alt.mx <- alt.mx[,wecare_samples]
ref.mx <- ref.mx[,wecare_samples]
dp.mx <- dp.mx[,wecare_samples]
gq.mx <- gq.mx[,wecare_samples]
rm(wecare_samples)
table(phenotypes.df$cc)
# Chunk 1: set_width
#eval=F
options(width = 999)
# https://stackoverflow.com/questions/36845178/width-of-r-code-chunk-output-in-rmarkdown-files-knitr-ed-to-html
# Chunk 2: start_section
Sys.time()
rm(list=ls())
graphics.off()
library(knitr)
library(dplyr)
library(tidyr) # for separate (samples names parsing)
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s07_read_data"
opts_knit$set(root.dir = base_folder)
options(stringsAsFactors = F)
options(warnPartialMatchArgs = T,
warnPartialMatchAttr = T,
warnPartialMatchDollar = T)
#options(error = browser()) # Type Q or c to exit, drop browser level
# https://support.rstudio.com/hc/en-us/articles/200713843?version=1.1.456&mode=desktop
# https://stackoverflow.com/questions/13052522/how-to-leave-the-r-browser-mode-in-the-console-window/13052588
# Chunk 3
data_folder="/Users/alexey/Documents/wecare/ampliseq/v04_ampliseq_nfe/s06_read_vcf_to_r"
load(paste(data_folder, "s01_read_vcf_to_r.RData", sep="/"))
base_folder="/Users/alexey/Documents/wecare/ampliseq/v05_ampliseq_only/s07_read_data"
genotypes.mx <- gt_add.mx
variants.df <- fixed.df
rm(data_folder, ad.mx, gt_chr.mx, gt_num.mx,gt_add.mx,fixed.df,meta.df)
# Chunk 4: read_data
data_folder="/Users/alexey/Documents/wecare/ampliseq/v04_ampliseq_nfe/s05_phenotypes"
# Phenotype data
phenotypes_2018_file <- paste(data_folder, "phenotypes_dec2018.txt", sep="/")
phenotypes_2018.df <- read.table(phenotypes_2018_file, header=T, sep="\t", quote="")
phenotypes_2019_file <- paste(data_folder, "phenotypes_jan2019.txt", sep="/")
phenotypes_2019.df <- read.table(phenotypes_2019_file, header=T, sep="\t", quote="")
# Clean-up
rm(phenotypes_2018_file, phenotypes_2019_file, data_folder)
# Chunk 5: compare_phenotypes
# Data sizes
dim(phenotypes_2018.df)
dim(phenotypes_2019.df)
# No missed data in both phenotype versions
sum(is.na(phenotypes_2018.df))
sum(is.na(phenotypes_2019.df))
# Avaiable annotations
colnames(phenotypes_2018.df)
colnames(phenotypes_2019.df)
# All fields of 2018 are present in 2019 and the data is the same
identical_fields <- colnames(phenotypes_2018.df)
sum(phenotypes_2018.df[,identical_fields] != phenotypes_2019.df[,identical_fields])
# New fields in 2019 data
colnames(phenotypes_2019.df)[! colnames(phenotypes_2019.df) %in% identical_fields]
# Keep only 2019 phenotype data
phenotypes.df <- phenotypes_2019.df
# Clean-up
rm(identical_fields, phenotypes_2018.df, phenotypes_2019.df)
# Chunk 6: phenotypes_rownames
# Get long samples names from the colnames of genotypes matrix
dim(genotypes.mx)
genotypes.mx[1:5,1:5]
genotypes.mx[1:5,541:542]
genotypes.mx[1:5,735:739]
wecare_samples.df <- data.frame(long_ids=colnames(genotypes.mx)[1:541])
# Split the long IDs for wecare samples
wecare_samples.df <- separate(wecare_samples.df, "long_ids", c("num", "illumina_id", "illumina_lane"),
sep="_", remove=F)
wecare_samples.df$num <- as.integer(wecare_samples.df$num)
dim(wecare_samples.df)
str(wecare_samples.df)
wecare_samples.df[1:5,]
# Sort wecare_samples.df by sample num (to sync with phenotypes.df)
wecare_samples.df <- wecare_samples.df[order(wecare_samples.df$num),]
wecare_samples.df[1:5,]
phenotypes.df[1:5,1:5]
# Bind add long IDs to phenotypes table
phenotypes.df <- cbind(wecare_samples.df, phenotypes.df)
# Check that numbers are identical
sum(phenotypes.df$num == phenotypes.df$Sample_num)
sum(phenotypes.df$num != phenotypes.df$Sample_num)
# Remove one of the numbers
phenotypes.df <- phenotypes.df[,-2]
dim(phenotypes.df)
colnames(phenotypes.df)
str(phenotypes.df)
# Set rownames
rownames(phenotypes.df) <- phenotypes.df$long_ids
# Clean-up
rm(wecare_samples.df)
# Chunk 7
wecare_samples <- rownames(phenotypes.df)
genotypes.mx <- genotypes.mx[,wecare_samples]
alt.mx <- alt.mx[,wecare_samples]
ref.mx <- ref.mx[,wecare_samples]
dp.mx <- dp.mx[,wecare_samples]
gq.mx <- gq.mx[,wecare_samples]
rm(wecare_samples)
# Function to detect uniform vectors (expects vectors containing 0,1,2 or NA only)
uniform.udf <- function(x){
if(all(is.na(x))) return(TRUE) # Return T if all are NA
min(x,na.rm=T)==max(x,na.rm=T)} # Return T if min=max, otherwise return F
uniform_variants <- apply(genotypes.mx, 1, uniform.udf)
sum(uniform_variants)
genotypes.mx <- genotypes.mx[!uniform_variants,]
variants.df <- variants.df[!uniform_variants,]
alt.mx <- alt.mx[!uniform_variants,]
ref.mx <- ref.mx[!uniform_variants,]
dp.mx <- dp.mx[!uniform_variants,]
gq.mx <- gq.mx[!uniform_variants,]
# Clean-up
rm(uniform_variants, uniform.udf)
table(phenotypes.df$cc)
dim(genotypes.mx)
dim(phenotypes.df)
dim(variants.df)
dim(alt.mx)
dim(ref.mx)
dim(gq.mx)
dim(dp.mx)
sum(colnames(genotypes.mx) != rownames(phenotypes.df))
sum(rownames(genotypes.mx) != rownames(variants.df))
sum(colnames(genotypes.mx) != rownames(phenotypes.df))
sum(colnames(genotypes.mx) != rownames(phenotypes.df))
sum(colnames(genotypes.mx) != colnames(alt.mx))
sum(colnames(genotypes.mx) != colnames(ref.mx))
sum(colnames(genotypes.mx) != colnames(gq.mx))
sum(colnames(genotypes.mx) != colnames(dp.mx))
sum(rownames(genotypes.mx) != rownames(variants.df))
sum(rownames(genotypes.mx) != rownames(alt.mx))
sum(rownames(genotypes.mx) != rownames(ref.mx))
sum(rownames(genotypes.mx) != rownames(gq.mx))
sum(rownames(genotypes.mx) != rownames(dp.mx))
table(phenotypes.df$cc)
save.image(paste(base_folder, "s01_read_data.RData", sep="/"))
